<html>
    <head>

    </head>
    <body>
        <!--Div for template engine to insert data into-->
        <div id="content">

        </div>
        <script>
            class SimpleTemplateEngine{
                constructor(template_url){
                    this.template_url = template_url
                }

                loadTemplate(){
                    // Returns promise (fetch)
                    return fetch(this.template_url)
                    .then(response => response.text())
                    .then(text => {
                        this.template = text;
                    })
                }

                //Parse and insert template into the DOM
                renderTemplate(tag_id, data){
                    const tag = document.getElementById(tag_id);

                    //See more ways of doing this in index.html
                    let output = this.template;

                    output = output.replace(/{{#each (\w+)}}([\s\S]*?){{\/each}}/g, (match,arrayName, templateFragment)=>{
                        const listOfThings = data[arrayName];
                        

                        if (!Array.isArray(listOfThings)){
                            return '';
                        }
                        return listOfThings.map(item => this.replaceVariablesInFragment(templateFragment, item)).join('');
                    });
                    output = output.replace(/{{(\w+)}}/g,(match, dataField) =>{
                        return data[dataField]
                    } )
                    console.log(output)
                    tag.innerHTML = output;
                }
                
                replaceVariablesInFragment(templateFragment,data){
                    return templateFragment.replace(/{{(\w+)}}/g, (match,dataKey)=>{
                        return data[dataKey]
                    })
                }
            };

            //Dummy data
            const data = {
                title: 'Page title',
                content: 'Page content',
                subtitle: 'Page subtitle',
                subcontent: 'Subcontent, ehm, content?',
                //Added data structure
                items: [
                {title:'item 1', description:'Description 1'},
                {title:'item 2', description:'Description 2'},
                {title:'item 3', description:'Description 3'}
                ]
            };
            const tEngine = new SimpleTemplateEngine("template2.html")

            
            tEngine.loadTemplate()
            .then(() =>{
                console.log("template loaded")
                tEngine.renderTemplate('content', data)
            })
        </script>
    </body>
</html>